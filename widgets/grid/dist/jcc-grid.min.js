/*
* JCC LIBRARY
*
* Copyright 2018 Boris Kamenov boriskamenov@abv.bg, www.stx-dev.com
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
jcc.widgets.grid={version:"1.1.11",can_enhance:function(e){return"DIV"==e.nodeName&&"grid"==e.getAttribute("data-role")},enhance:function(e){e.grid?e.grid.refresh():new jcc.grid(e).refresh()},unenhance:function(e){e.grid&&e.grid.destroy()}},jcc.grid=function(el){this.widget=jcc.widget,this.widget(el);var DEFAULT_ROW_HEIGHT=32,EXTRA_SPACE_PER_SIDE=200,theme,rowHeight,items,columns,columnsArray,columnWidths,view,viewContents,vScrollDetermine,fakeRows,headerElement,prevContentsHscroll,prevContentsVscroll,prevViewHeight,rangeSelect,appendSelect,lastSelectedItem,allUnbound,rowCounter;function onESort(event){el.dataset.eSort&&el.dataset.eSort.length>0&&eval(el.dataset.eSort)}function onEClickRow(event){el.dataset.eClickRow&&el.dataset.eClickRow.length>0&&eval(el.dataset.eClickRow)}function onEColumnResize(event){if(columnWidths[event.detail.column]=event.detail.width,fakeRows)for(var i=0;i<fakeRows.length;i++)fakeRows[i][event.detail.column].parentNode.style.width=event.detail.width+"px";el.dataset.eColumnResize&&el.dataset.eColumnResize.length>0&&eval(el.dataset.eColumnResize)}function onEColumnManualResize(event){el.dataset.eColumnManualResize&&el.dataset.eColumnManualResize.length>0&&eval(el.dataset.eColumnManualResize)}function onEBindRow(event){el.dataset.eBindRow&&el.dataset.eBindRow.length>0&&eval(el.dataset.eBindRow)}function onEUnbindRow(event){el.dataset.eUnbindRow&&el.dataset.eUnbindRow.length>0&&eval(el.dataset.eUnbindRow)}function onESelection(event){el.dataset.eSelection&&el.dataset.eSelection.length>0&&eval(el.dataset.eSelection)}function onShiftDown(e){"Shift"==e.key&&el.grid.rangeSelect(!0)}function onShiftUp(e){el.grid.rangeSelect()&&"Shift"==e.key&&el.grid.rangeSelect(!1)}function onCtrlDown(e){"Control"==e.key&&el.grid.appendSelect(!0)}function onCtrlUp(e){el.grid.appendSelect()&&"Control"==e.key&&el.grid.appendSelect(!1)}function createView(){(view=document.createElement("div")).dataset.role="scrollable",view.dataset.scrollDirection="all",view.dataset.kinetics=el.dataset.kinetics,view.dataset.hScrollbarLocation="bottom",view.dataset.vScrollbarLocation="right",view.dataset.scrollbarsVisibility=el.dataset.scrollbarsVisibility,view.classList.add("jcc-grid-view"),view.addEventListener("e-scroll",onViewScroll,!1),el.appendChild(view),viewContents=document.createElement("div"),view.appendChild(viewContents),(vScrollDetermine=document.createElement("div")).classList.add("jcc-grid-view-contents-v-scroll-determine"),viewContents.appendChild(vScrollDetermine),jcc.enhance(view),fakeRows=[],allUnbound=!0}function bindRow(e,t){if(allUnbound=!1,items[t].__$cells$__=e,"yes"==el.dataset.biColor&&(t%2?(e.__$row$__.classList.remove("jcc-grid-fake-row-even-"+theme),e.__$row$__.classList.add("jcc-grid-fake-row-odd-"+theme)):(e.__$row$__.classList.add("jcc-grid-fake-row-even-"+theme),e.__$row$__.classList.remove("jcc-grid-fake-row-odd-"+theme))),items[t].__$selected$__&&e.__$row$__.classList.add("jcc-grid-fake-row-selected-"+theme),jcc.dispatchCustomEvent(el,"e-bind-row",{bubbles:!1,cancelable:!0,detail:{rowElement:e.__$row$__,cells:e,items:items,index:t}}).defaultPrevented)for(n=0;n<columnsArray.length;n++){(s=e[o=columnsArray[n].id].__$defaultCell$__).style.display="none"}else for(var n=0;n<columnsArray.length;n++){var o,s;e[o=columnsArray[n].id].dataset.align=columnsArray[n].dataset.align,(s=e[o].__$defaultCell$__).style.display="",s.innerHTML=jcc.xmlEncode(items[t][o].value.toString())}}function unbindRow(e,t){if(e.__$row$__.classList.remove("jcc-grid-fake-row-selected-"+theme),!jcc.dispatchCustomEvent(el,"e-unbind-row",{bubbles:!1,cancelable:!0,detail:{rowElement:e.__$row$__,cells:e,items:items,index:t}}).defaultPrevented)for(var n=0;n<columnsArray.length;n++){e[columnsArray[n].id].childNodes[0].innerHTML=""}delete items[t].__$cells$__}function reindexRows(){if(fakeRows&&viewContents)for(var e=viewContents.scrollTop,t=fakeRows.length,n=Math.floor(EXTRA_SPACE_PER_SIDE/rowHeight),o=Math.floor(e/rowHeight)-n,s=e-n*rowHeight-e%rowHeight,i=0;i<t;i++){var l=fakeRows[i];l.itemIndex>=0&&unbindRow(l,l.itemIndex),l.__$top$__=s,l.__$row$__.style.top=l.__$top$__+"px",l.itemIndex=o<0||o>=items.length?-1:o,o++,s+=rowHeight,l.itemIndex>=0?(l.__$row$__.style.display="",bindRow(l,l.itemIndex)):l.__$row$__.style.display="none"}}function onViewScroll(){var e=viewContents.scrollLeft;prevContentsHscroll!=e&&(columnsArray[0].style.marginLeft=-e+"px",prevContentsHscroll=e);var t=viewContents.scrollTop;if(prevContentsVscroll!=t){null==prevContentsVscroll&&(prevContentsVscroll=0);var n=t-prevContentsVscroll;prevContentsVscroll=t;var o=fakeRows.length;if(0==o)return;if(n>0){if((i=fakeRows[o-1]).__$top$__+rowHeight-t<-EXTRA_SPACE_PER_SIDE)return el.grid.unbindRows(),void reindexRows();for(var s=0;s<o;s++){if(!((i=fakeRows[0]).__$top$__+rowHeight-t<-EXTRA_SPACE_PER_SIDE))break;i.itemIndex>=0&&(unbindRow(i,i.itemIndex),i.itemIndex=-1),i.__$top$__=fakeRows[o-1].__$top$__+rowHeight,i.__$row$__.style.top=i.__$top$__+"px",fakeRows[o-1].itemIndex>=0&&(i.itemIndex=fakeRows[o-1].itemIndex+1,i.itemIndex>=items.length&&(i.itemIndex=-1)),fakeRows.shift(),fakeRows.push(i),i.itemIndex>=0?(i.__$row$__.style.display="",bindRow(i,i.itemIndex)):i.__$row$__.style.display="none"}}else if(n<0){if((i=fakeRows[0]).__$top$__-t>prevViewHeight+EXTRA_SPACE_PER_SIDE)return el.grid.unbindRows(),void reindexRows();for(s=0;s<o;s++){var i;(i=fakeRows[o-1]).__$top$__-t>prevViewHeight+EXTRA_SPACE_PER_SIDE&&(i.itemIndex>=0&&(unbindRow(i,i.itemIndex),i.itemIndex=-1),i.__$top$__=fakeRows[0].__$top$__-rowHeight,i.__$row$__.style.top=i.__$top$__+"px",fakeRows[0].itemIndex>=0&&(i.itemIndex=fakeRows[0].itemIndex-1,i.itemIndex<0&&(i.itemIndex=-1)),fakeRows.pop(),fakeRows.unshift(i),i.itemIndex>=0?(i.__$row$__.style.display="",bindRow(i,i.itemIndex)):i.__$row$__.style.display="none")}}}}function createFakeRow(e,t){var n=document.createElement("div");n.classList.add("jcc-grid-fake-row"),n.classList.add("jcc-grid-fake-row-"+theme),n.style.top=e+"px",n.style.height=rowHeight+"px",viewContents.appendChild(n),"no"==el.dataset.biColor&&n.classList.add("jcc-grid-fake-row-even-"+theme);var o={itemIndex:t,__$top$__:e,__$row$__:n};n.addEventListener("click",function(){var e=o.itemIndex;if(!jcc.dispatchCustomEvent(el,"e-click-row",{bubbles:!1,cancelable:!0,detail:{rowElement:n,cells:o,items:items,index:e}}).defaultPrevented&&"none"!=el.dataset.selection){var t=items[e];if(rangeSelect)if(null==lastSelectedItem)t.__$selected$__||el.grid.scrollTo(e),el.grid.selection([e],!0,t.__$selected$__);else{var s=[e],i=el.grid.itemIndex(lastSelectedItem);if(e>i)for(var l=e-1;l>=i;l--)s.push(l);else if(e<i)for(l=e+1;l<=i;l++)s.push(l);el.grid.scrollTo(e),el.grid.selection(s)}else t.__$selected$__||el.grid.scrollTo(e),s=el.grid.selection(),el.grid.selection([e],appendSelect,t.__$selected$__),!appendSelect&&s.length>1&&el.grid.selection([e])}},!1);for(var s=0;s<columnsArray.length;s++){var i=columnsArray[s].id,l=document.createElement("div");l.classList.add("jcc-grid-fake-row-cell"),l.classList.add("jcc-grid-fake-row-cell-"+theme),l.style.width=columnWidths[i]+"px",n.appendChild(l);var d=document.createElement("div");d.classList.add("jcc-grid-fake-row-cell-placeholder"),l.appendChild(d);var r=document.createElement("div");r.classList.add("jcc-grid-default-cell"),d.appendChild(r),o[i]=d,d.__$defaultCell$__=r}fakeRows.push(o)}function adjustScrollHeight(){if(vScrollDetermine){var e=items.length*rowHeight;vScrollDetermine.style.height=e+"px"}}function onViewResize(){var e=jcc.getElementLocalRect(view).height;if(prevViewHeight!=e){prevViewHeight=e;var t=Math.max(Math.floor((e+2*EXTRA_SPACE_PER_SIDE)/rowHeight+1),3),n=fakeRows.length;if(t>n){var o=-Math.floor(EXTRA_SPACE_PER_SIDE/rowHeight)*rowHeight,s=0==n?o:fakeRows[n-1].__$top$__+rowHeight,i=0==n?-1:fakeRows[n-1].itemIndex;i>=0&&i++,i>=items.length&&(i=-1);for(var l=t-n,d=0;d<l;d++)createFakeRow(s,i)}}el.grid.refreshItems()}function destroyView(){if(el.grid.selection().length>0&&el.grid.unselectAll(),view){if(jcc.unenhance(view),viewContents){vScrollDetermine&&(viewContents.removeChild(vScrollDetermine),vScrollDetermine=void 0);for(var e=0;e<fakeRows.length;e++){var t=fakeRows[e];if(t.itemIndex>=0)unbindRow(items[t.itemIndex].__$cells$__,t.itemIndex);for(var n=t.__$row$__,o=0;o<n.childNodes.length;o++){for(var s=n.childNodes[0],i=0;i<s.childNodes.length;i++){for(var l=s.childNodes[0],d=0;d<l.childNodes.length;d++){var r=l.childNodes[0];l.removeChild(r)}s.removeChild(l)}n.removeChild(s)}viewContents.removeChild(n)}fakeRows=void 0;for(e=0;e<items.length;e++)delete items[e].__$selected$__,delete items[e].__$unselectable$__,delete items[e].__$cells$__;items=void 0,view.removeChild(viewContents),viewContents=void 0}el.removeChild(view),view=void 0}}this.reservedColumnIDs={itemIndex:!0,__$top$__:!0,__$row$_:!0,__$enum$__:!0,__$selected$__:!0,__$unselectable$__:!0},this.refresh=function(){this.destroy(),"flat"!=el.dataset.corners&&"smooth"!=el.dataset.corners&&(el.dataset.corners="smooth"),"normal"!=el.dataset.isotope&&"inset"!=el.dataset.isotope&&(el.dataset.isotope="normal"),"yes"!=el.dataset.biColor&&"no"!=el.dataset.biColor&&(el.dataset.biColor="yes"),"none"!=el.dataset.selection&&"single"!=el.dataset.selection&&"multiple"!=el.dataset.selection&&(el.dataset.selection="none"),"always"!=el.dataset.scrollbarsVisibility&&"fade"!=el.dataset.scrollbarsVisibility&&"none"!=el.dataset.scrollbarsVisibility&&(el.dataset.scrollbarsVisibility="fade"),"yes"!=el.dataset.kinetics&&"no"!=el.dataset.kinetics&&(el.dataset.kinetics="yes"),el.dataset.items&&0!=el.dataset.items.length||(el.dataset.items="[]");var htmlCols=el.querySelectorAll("*[data-role='grid-column']"),itemsOrig;columns={},columnsArray=[],columnWidths={};for(var i=0;i<htmlCols.length;i++){var col=htmlCols[i];if(1==this.reservedColumnIDs[col.id])return void alert("JCC: The column ID '"+col.id+"' is reserved for internal use of JCC. Please specify another column ID!");columns[col.id]=col,columnsArray.push(col)}rowHeight=parseInt(el.dataset.rowHeight),(isNaN(rowHeight)||rowHeight<1)&&(rowHeight=DEFAULT_ROW_HEIGHT,el.dataset.rowHeight=DEFAULT_ROW_HEIGHT),EXTRA_SPACE_PER_SIDE=Math.max(EXTRA_SPACE_PER_SIDE,3*rowHeight);try{if(eval("itemsOrig="+el.dataset.items),null==itemsOrig||null==itemsOrig.length||isNaN(itemsOrig.length))throw"Incorrect items source provided!"}catch(e){return void alert("JCC: The items JavaScript you have specified for the grid seems to have errors. Please revise the data-items attribute data!")}el.grid=this,theme=this.theme(),rowCounter=0,lastSelectedItem=null,el.classList.add("jcc-grid"),el.classList.add("jcc-grid-"+theme);var position=jcc.getComputedStyle(el,"position");"static"==position&&el.classList.add("jcc-grid-relative"),headerElement=el.querySelector("*[data-role='grid-header']"),items=[],el.addEventListener("e-sort",onESort,!1),el.addEventListener("e-click-row",onEClickRow,!1),el.addEventListener("e-column-resize",onEColumnResize,!1),el.addEventListener("e-column-manual-resize",onEColumnManualResize,!1),el.addEventListener("e-bind-row",onEBindRow,!1),el.addEventListener("e-unbind-row",onEUnbindRow,!1),el.addEventListener("e-selection",onESelection,!1),window.addEventListener("keydown",onShiftDown,{passive:!1,capture:!1}),window.addEventListener("keyup",onShiftUp,{passive:!1,capture:!1}),window.addEventListener("keydown",onCtrlDown,{passive:!1,capture:!1}),window.addEventListener("keyup",onCtrlUp,{passive:!1,capture:!1}),setTimeout(function(){createView(),onViewResize(),el.addEventListener("e-resized",onViewResize,!1),jcc.resizeMonitor.addElement(el);for(var e=0;e<itemsOrig.length;e++)el.grid.addItem(itemsOrig[e],e==itemsOrig.length-1);jcc.dispatchCustomEvent(el,"e-selection",{bubbles:!1,cancelable:!1,detail:{selection:[],items:items}})},0)},this.destroy=function(){el.removeEventListener("e-sort",onESort),el.removeEventListener("e-click-row",onEClickRow),el.removeEventListener("e-column-resize",onEColumnResize),el.removeEventListener("e-column-manual-resize",onEColumnManualResize),el.removeEventListener("e-resized",onViewResize),el.removeEventListener("e-bind-row",onEBindRow),el.removeEventListener("e-unbind-row",onEUnbindRow),el.removeEventListener("e-selection",onESelection),window.removeEventListener("keydown",onShiftDown),window.removeEventListener("keyup",onShiftUp),window.removeEventListener("keydown",onCtrlDown),window.removeEventListener("keyup",onCtrlUp),el.grid&&(jcc.resizeMonitor.removeElement(el),destroyView(),el.classList.remove("jcc-grid"),el.classList.remove("jcc-grid-"+theme),el.classList.remove("jcc-grid-relative"),delete el.grid),columns=void 0,columnsArray=void 0,columnWidths=void 0,headerElement=void 0,prevContentsHscroll=void 0,prevViewHeight=void 0},this.fakeRows=function(){return fakeRows},this.sort=function(e,t){if(null==e&&null==t){for(var n in columns){if(null!=columns[n].id)if("yes"==columns[n].dataset.sortable&&"none"!=columns[n].dataset.sort)return{column:columns[n].id,sort:columns[n].dataset.sort}}return{sort:"none"}}if(columns[e]&&"no"!=columns[e].dataset.sortable){for(var n in columns){if(null!=columns[n].id)columns[n].id==e?columns[n].dataset.sort=t?"asc":"desc":columns[n].dataset.sort="none",(!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g))&&(columns[n].style.display="none",columns[n].style.display="")}items.length>0&&(this.unbindRows(),jcc.sortedSubfieldArray(items,e,"sortValue",!0,!t),reindexRows()),jcc.dispatchCustomEvent(el,"e-sort",{bubbles:!1,cancelable:!0,detail:{column:e,ascending:t,items:items}})}},this.column=function(e){return columns[e]?columns[e].gridColumn:void 0},this.itemIndex=function(e){return items.findIndexCompare(e,function(e,t){return e==t})},this.itemChangedSortValue=function(e,t){if(null==t&&(t=!0),null!=this.sort().column){this.unbindRows();var n=this.itemIndex(e);items.splice(n,1),items.add(e),t&&reindexRows()}},this.itemsChangedSortValue=function(){var e=this.sort();null!=e.column&&(this.unbindRows(),jcc.sortedSubfieldArray(items,e.column,"sortValue",!0,"desc"==e.sort),reindexRows())},this.refreshItem=function(e){for(var t=0;t<fakeRows.length;t++){var n=fakeRows[t];if(n.itemIndex==e){unbindRow(n,e),bindRow(n,e);break}}},this.refreshItems=function(){adjustScrollHeight(),this.unbindRows(),reindexRows()},this.unbindRows=function(){if(!allUnbound){if(fakeRows)for(var e=0;e<fakeRows.length;e++){var t=fakeRows[e];t.itemIndex>=0&&(unbindRow(t,t.itemIndex),t.itemIndex=-1)}allUnbound=!0}},this.itemsSelectable=function(e,t){if(null==t){for(var n=[],o=0;o<e.length;o++)n.push(1!=items[e[o]].__$unselectable$__);return n}var s=this.selection(),i={};for(o=0;o<s.length;o++)i[s[o]]=!0;s=[];for(o=0;o<e.length;o++){var l=e[o];items[l].__$unselectable$__=!t,1==i[l]&&0==t&&s.push(o)}s.length>0&&this.selection(s,!1,!0)},this.items=function(){return items},this.addItem=function(e,t){if(null==t&&(t=!0),e.__$enum$__=rowCounter++,this.unbindRows(),items.push(e),t){var n=this.sort();null!=n.column?jcc.sortedSubfieldArray(items,n.column,"sortValue",!0,"desc"==n.sort):jcc.sortedArray(items,"__$enum$__",!1),adjustScrollHeight(),reindexRows()}},this.removeItems=function(e){if(0!=e.length){var t=!1;if(e.sort(function(e,t){return e>t?1:-1}),fakeRows)for(var n=0;n<fakeRows.length;n++){var o=fakeRows[n];o.itemIndex>=0&&(unbindRow(o,o.itemIndex),o.itemIndex=-1)}for(n=0;n<e.length;n++){var s=e[n]-n,i=items[s];i.__$selected$__&&(t=!0,lastSelectedItem==i&&(lastSelectedItem=null)),items.splice(s,1)}adjustScrollHeight(),reindexRows(),t&&jcc.dispatchCustomEvent(el,"e-selection",{bubbles:!1,cancelable:!1,detail:{selection:el.grid.selection(),items:items}})}},this.removeAll=function(){var e=this.selection();this.unbindRows(),items.length=0,lastSelectedItem=null,adjustScrollHeight(),reindexRows(),e.length>0&&jcc.dispatchCustomEvent(el,"e-selection",{bubbles:!1,cancelable:!1,detail:{selection:[],items:items}})},this.rangeSelect=function(e){if(0==arguments.length)return 1==rangeSelect;rangeSelect=e},this.appendSelect=function(e){if(0==arguments.length)return 1==appendSelect;appendSelect=e},this.selection=function(e,t,n){if(0==arguments.length){for(var o=[],s=0;s<items.length;s++)items[s].__$selected$__&&o.push(s);return o}if("none"!=el.dataset.selection){if("single"==el.dataset.selection&&e.length>1&&e.splice(1,e.length-1),!t||"single"==el.dataset.selection)for(s=0;s<items.length;s++){if(items[s].__$selected$__)items[s].__$selected$__=!1,(l=items[s].__$cells$__)&&(unbindRow(l,s),bindRow(l,s))}var i=null;for(s=0;s<e.length;s++){var l,d=e[s],r=items[d].__$selected$__;items[d].__$unselectable$__||n?items[d].__$selected$__=!1:(items[d].__$selected$__=!0,i=items[d]),(l=items[d].__$cells$__)&&r!=items[d].__$selected$__&&(unbindRow(l,d),bindRow(l,d))}var a=this.selection();0==a.length?lastSelectedItem=null:(rangeSelect&&null==lastSelectedItem||!rangeSelect)&&(lastSelectedItem=i),jcc.dispatchCustomEvent(el,"e-selection",{bubbles:!1,cancelable:!1,detail:{selection:a,items:items}})}},this.selectAll=function(){for(var e=[],t=0;t<items.length;t++)e.push(t);this.selection(e,!0)},this.unselectAll=function(){this.selection([])},this.scrollTo=function(e){if(e<0&&(e=0),e>=items.length&&(e=items.length-1),!(e<0)){var t=view.scrollable.scrollTop(),n=e*rowHeight-t,o=jcc.getElementLocalRect(viewContents),s={left:0,right:o.width,top:n,bottom:n+rowHeight,width:o.width,height:rowHeight};n=0,s.bottom>o.bottom&&(n=s.bottom-o.bottom+Math.round(.7*rowHeight),s.top-=n,s.bottom-=n),s.top<o.top&&(n+=s.top-o.top-Math.round(.7*rowHeight)),0!=n&&view.scrollable.scrollBy(0,n)}},this.getVisibleItems=function(){for(var e=[],t=0;t<fakeRows.length;t++){var n=fakeRows[t];n.itemIndex>=0&&e.push(n.itemIndex)}return e}},jcc.widgets["grid-header"]={version:"1.0",can_enhance:function(e){return"DIV"==e.nodeName&&"grid-header"==e.getAttribute("data-role")},enhance:function(e){e.gridHeader?e.gridHeader.refresh():new jcc.gridHeader(e).refresh()},unenhance:function(e){e.gridHeader&&e.gridHeader.destroy()}},jcc.gridHeader=function(e){var t;this.widget=jcc.widget,this.widget(e),this.refresh=function(){e.parentNode.grid?(this.destroy(),"small"!=e.dataset.size&&"normal"!=e.dataset.size&&"large"!=e.dataset.size&&(e.dataset.size="normal"),"yes"!=e.dataset.visible&&"no"!=e.dataset.visible&&(e.dataset.visible="no"),e.gridHeader=this,t=this.theme(),e.classList.add("jcc-grid-header"),e.classList.add("jcc-grid-header-"+t)):alert("JCC: The 'grid-header' must be a direct child of a 'grid'. Please revise your HTML code!")},this.destroy=function(){e.gridHeader&&(e.classList.remove("jcc-grid-header"),e.classList.remove("jcc-grid-header-"+t),delete e.gridHeader)}},jcc.widgets["grid-column"]={version:"1.0",can_enhance:function(e){return"DIV"==e.nodeName&&"grid-column"==e.getAttribute("data-role")},enhance:function(e){e.gridColumn?e.gridColumn.refresh():new jcc.gridColumn(e).refresh()},unenhance:function(e){e.gridColumn&&e.gridColumn.destroy()}},jcc.gridColumn=function(e){this.widget=jcc.widget,this.widget(e);var t,n,o,s,i,l,d,r,a,c=2,h={small:44,normal:54,large:56};function _(e){var t=parseInt(e);return/^\d+%$/.test(e)&&(t=Math.round(i.clientWidth*t/100)),t}function u(t){if(null==t)return e.offsetWidth;var n=_(e.dataset.minWidth);if(t<n&&(t=n),"auto"!=e.dataset.maxWidth){var o=_(e.dataset.maxWidth);o<n&&(o=n),t>o&&(t=o)}e.style.width=t+"px",jcc.dispatchCustomEvent(s.element(),"e-column-resize",{bubbles:!1,cancelable:!0,detail:{column:e.id,width:t}})}function m(){u(_(e.dataset.width))}function v(t){a>c?(a=0,t.preventDefault(),t.stopPropagation()):s.sort(e.id,"asc"!=e.dataset.sort)}function f(t){var n;t.touches&&t.touches.length>1||(n=t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0].pageX:t.pageX,l=n,d=e.gridColumn.width(),a=0,r=!0)}function g(t){if(r&&!(t.touches&&t.touches.length>1)){var n,o=(n=t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0].pageX:t.pageX)-l;d+=o,e.gridColumn.width(d),l=n,a+=Math.abs(o),jcc.dispatchCustomEvent(s.element(),"e-column-manual-resize",{bubbles:!1,cancelable:!0,detail:{column:e.id,width:e.gridColumn.width()}}),t.preventDefault(),t.stopPropagation()}}function w(e){r&&(r=!1)}this.super_setOptions=this.setOptions,this.setOptions=function(t){this.super_setOptions(t),null!=t.align&&s.refreshItems(),null!=t.sort&&"none"!=t.sort&&s.sort(e.id,"asc"==e.dataset.sort)},this.refresh=function(){if(e.parentNode.gridHeader)if(e.id&&0!=e.id.length)if(this.destroy(),n=e.querySelector("div:first-child"),"yes"!=e.parentNode.dataset.visible||n){i=e.parentNode,"none"!=e.dataset.sort&&"asc"!=e.dataset.sort&&"desc"!=e.dataset.sort&&(e.dataset.sort="none"),"yes"!=e.dataset.resizable&&"no"!=e.dataset.resizable&&(e.dataset.resizable="no"),"yes"!=e.dataset.sortable&&"no"!=e.dataset.sortable&&(e.dataset.sortable="no"),(null==e.dataset.width||0==/^\d+$/.test(e.dataset.width)&&0==/^\d+%$/.test(e.dataset.width)||1==/^\d+$/.test(e.dataset.width)&&parseInt(e.dataset.width)<h[i.dataset.size])&&(e.dataset.width=h[i.dataset.size]),(null==e.dataset.minWidth||0==/^\d+$/.test(e.dataset.minWidth)&&0==/^\d+%$/.test(e.dataset.minWidth)||1==/^\d+$/.test(e.dataset.minWidth)&&parseInt(e.dataset.minWidth)<h[i.dataset.size])&&(e.dataset.minWidth=h[i.dataset.size]),(null==e.dataset.maxWidth||0==/^\d+$/.test(e.dataset.maxWidth)&&0==/^\d+%$/.test(e.dataset.maxWidth))&&(e.dataset.maxWidth="auto"),"left"!=e.dataset.align&&"right"!=e.dataset.align&&"center"!=e.dataset.align&&(e.dataset.align="left"),e.gridColumn=this,t=this.theme(),e.classList.add("jcc-grid-column"),e.classList.add("jcc-grid-column-"+t),"yes"==e.dataset.resizable&&(o=document.createElement("div"),e.appendChild(o),o.classList.add("jcc-grid-column-resize-grip"),o.classList.add("jcc-grid-column-resize-grip-"+t),o.addEventListener("mousedown",f,!1),o.addEventListener("touchstart",f,!1),document.addEventListener("mousemove",g,{passive:!1,capture:!1}),document.addEventListener("touchmove",g,{passive:!1,capture:!1}),document.addEventListener("mouseup",w,{passive:!1,capture:!1}),document.addEventListener("touchend",w,{passive:!1,capture:!1})),n&&n.classList.add("jcc-grid-column-placeholder");var l=i.parentNode;l.addEventListener("e-resized",m,!1),s=l.grid,m(),"yes"==e.dataset.sortable&&e.addEventListener("click",v,!1)}else alert("JCC: Visible columns musta contain a placeholder DIV. Please revise your HTML code!");else alert("JCC: Each 'grid-column' must have an unique ID. Please revise your HTML code!");else alert("JCC: The 'grid-column' must be a direct child of a 'grid-header'. Please revise your HTML code!")},this.destroy=function(){e.gridColumn&&(e.classList.remove("jcc-grid-column"),e.classList.remove("jcc-grid-column-"+t),e.removeEventListener("click",v),e.parentNode.parentNode.removeEventListener("e-resized",m),n&&(n.classList.remove("jcc-grid-column-placeholder"),n=void 0),o&&(e.removeChild(o),o=void 0,document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",g),document.removeEventListener("mouseup",w),document.removeEventListener("touchend",w)),delete e.gridColumn);i=void 0},this.width=function(t){if(null==t)return e.offsetWidth;u(t),e.dataset.width=t}},jcc.widgets["grid-column-label"]={version:"1.0",can_enhance:function(e){return"DIV"==e.nodeName&&"grid-column-label"==e.getAttribute("data-role")},enhance:function(e){e.gridColumnLabel?e.gridColumnLabel.refresh():new jcc.gridColumnLabel(e).refresh()},unenhance:function(e){e.gridColumnLabel&&e.gridColumnLabel.destroy()}},jcc.gridColumnLabel=function(e){this.widget=jcc.widget,this.widget(e),this.refresh=function(){e.parentNode.parentNode.gridColumn?(this.destroy(),"no"!=e.dataset.multiline&&"yes"!=e.dataset.multiline&&(e.dataset.multiline="no"),e.gridColumnLabel=this,this.theme(),e.classList.add("jcc-grid-column-label")):alert("JCC: The 'grid-column-label' must be a direct child of a 'grid-column'-placeholder. Please revise your HTML code!")},this.destroy=function(){e.gridColumnLabel&&(e.classList.remove("jcc-grid-column-label"),delete e.gridColumnLabel)}},jcc.widgets["grid-footer"]={version:"1.0",can_enhance:function(e){return"DIV"==e.nodeName&&"grid-footer"==e.getAttribute("data-role")},enhance:function(e){e.gridFooter?e.gridFooter.refresh():new jcc.gridFooter(e).refresh()},unenhance:function(e){e.gridFooter&&e.gridFooter.destroy()}},jcc.gridFooter=function(e){var t;this.toolbar=jcc.toolbar,this.toolbar(e),this.super_refresh=this.refresh,this.super_destroy=this.destroy,this.refresh=function(){e.parentNode.grid?(e.dataset.orientation="horizontal",e.dataset.position="bottom","yes"!=e.dataset.visible&&"no"!=e.dataset.visible&&(e.dataset.visible="yes"),this.destroy(),this.super_refresh(),e.gridFooter=this,t=this.theme(),e.classList.add("jcc-grid-footer"),e.classList.add("jcc-grid-footer-"+t)):alert("JCC: The 'grid-footer' must be a direct child of a 'grid'. Please revise your HTML code!")},this.destroy=function(){this.super_destroy(),e.gridFooter&&(e.classList.remove("jcc-grid-footer"),e.classList.remove("jcc-grid-footer-"+t),delete e.gridFooter)}},jcc.widgets.tree={version:"1.1.1",can_enhance:function(e){return"DIV"==e.nodeName&&"tree"==e.getAttribute("data-role")},enhance:function(e){e.tree?e.tree.refresh():new jcc.tree(e).refresh()},unenhance:function(e){e.tree&&e.tree.destroy()}},jcc.tree=function(el){this.grid=jcc.grid,this.grid(el),this.super_refresh=this.refresh,this.super_destroy=this.destroy,this.super_selection=this.selection,this.super_scrollTo=this.scrollTo;var NODE_LEVEL_INDENT=16,theme,roots,sortFunc,header,column,cname,nodeCounter,indent,lastSelectedNode,selectedNodes,collapseSelectionChanged,viewContents;function treeNode(){this.__$level$__=0,this.__$nodeIndex$__=-1,this.__$expanded$__=!1,this.parentNode=null,this.childNodes=[],this.isExpanded=function(){return this.__$expanded$__}}function onESelection(event){el.dataset.eSelection&&el.dataset.eSelection.length>0&&eval(el.dataset.eSelection)}function onEClickTreeRow(event){el.dataset.eClickTreeRow&&el.dataset.eClickTreeRow.length>0&&eval(el.dataset.eClickTreeRow)}function onEBindNode(event){el.dataset.eBindNode&&el.dataset.eBindNode.length>0&&eval(el.dataset.eBindNode)}function onEUnbindNode(event){el.dataset.eUnbindNode&&el.dataset.eUnbindNode.length>0&&eval(el.dataset.eUnbindNode)}function onRowClick(e){var t=e.detail.rowElement,n=e.detail.cells,o=e.detail.items,s=o[e.detail.index][cname].value;if((e.preventDefault(),!jcc.dispatchCustomEvent(el,"e-click-tree-row",{bubbles:!1,cancelable:!0,detail:{rowElement:t,node:s,iconElement:n.__$icon$__,textElement:n.__$text$__}}).defaultPrevented)&&"none"!=el.dataset.selection)if(el.tree.rangeSelect())if(lastSelectedNode){var i=[s];if(s.__$nodeIndex$__>=0&&lastSelectedNode.__$nodeIndex$__>=0)if(s.__$nodeIndex$__>lastSelectedNode.__$nodeIndex$__)for(var l=s.__$nodeIndex$__-1;l>=lastSelectedNode.__$nodeIndex$__;l--){var d=o[l][cname].value;i.push(d)}else if(s.__$nodeIndex$__<lastSelectedNode.__$nodeIndex$__)for(l=s.__$nodeIndex$__+1;l<=lastSelectedNode.__$nodeIndex$__;l++){d=o[l][cname].value;i.push(d)}el.tree.scrollTo(s),el.tree.selection(i)}else s.__$selected$__||el.tree.scrollTo(s),el.tree.selection([s],!0,s.__$selected$__);else{s.__$selected$__||el.tree.scrollTo(s);var r=el.tree.appendSelect();!r&&selectedNodes.length>1?el.tree.selection([s]):el.tree.selection([s],r,s.__$selected$__)}}function prepareFakeRow(e){if(null==e.__$placeholder$__){e[cname].classList.add("jcc-tree-node-cell");var t=document.createElement("div");t.classList.add("jcc-tree-node-placeholder"),e.__$placeholder$__=t;var n=document.createElement("div");n.classList.add("jcc-tree-node-arrow"),t.appendChild(n),e.__$arrow$__=n;var o=document.createElement("i");o.classList.add("jcc-tree-node-icon"),o.dataset.role="icon",t.appendChild(o),e.__$icon$__=o,jcc.enhance(o);var s=document.createElement("div");s.classList.add("jcc-tree-node-text"),t.appendChild(s),e.__$text$__=s}}function unprepareFakeRows(){for(var e=el.tree.fakeRows(),t=0;t<e.length;t++){var n=e[t];if(null!=n.__$placeholder$__){var o=n.__$placeholder$__;o.parentNode==n[cname]&&n[cname].removeChild(o),delete n.__$placeholder$__;var s=n.__$arrow$__;o.removeChild(s),delete n.__$arrow$__;var i=n.__$icon$__;jcc.unenhance(i),o.removeChild(i),delete n.__$icon$__;var l=n.__$text$__;o.removeChild(l),delete n.__$text$__}}}function adjustFakeRows(){for(var e=el.tree.fakeRows(),t=0;t<e.length;t++){e[t][cname].parentNode.style.width="0px"}var n=Math.abs(el.scrollWidth-viewContents.scrollWidth)<=8?viewContents.scrollWidth:viewContents.scrollWidth+8;for(t=0;t<e.length;t++){e[t][cname].parentNode.style.width=n+"px"}}function onViewResize(){adjustFakeRows()}function onBindRow(e){var t=e.detail.rowElement,n=e.detail.items,o=e.detail.cells,s=n[e.detail.index][cname].value;prepareFakeRow(o),s.__$selected$__&&t.classList.add("jcc-grid-fake-row-selected-"+theme),o.__$arrow$__.onclick=function(e){el.tree.expanded(s,!s.isExpanded(),!1,!0),s.isExpanded()&&el.tree.scrollTo(s.childNodes[0]),e.preventDefault(),e.stopPropagation()},o.__$arrow$__.style.visibility=s.childNodes.length>0?"":"hidden",o.__$placeholder$__.dataset.expanded=s.isExpanded()?"yes":"no",o.__$placeholder$__.style.marginLeft=s.__$level$__*indent+"px",jcc.dispatchCustomEvent(el,"e-bind-node",{bubbles:!1,cancelable:!0,detail:{rowElement:t,node:s,iconElement:o.__$icon$__,textElement:o.__$text$__}}).defaultPrevented||(o.__$text$__.innerHTML=jcc.xmlEncode(s.value)),null==s.icon||0==s.icon.length?o.__$icon$__.style.display="none":(o.__$icon$__.style.display="",o.__$icon$__.icon.setOptions({icon:s.icon})),o[cname].appendChild(o.__$placeholder$__),e.preventDefault()}function onUnbindRow(e){var t=e.detail.rowElement,n=e.detail.items,o=e.detail.cells,s=n[e.detail.index][cname];(t.classList.remove("jcc-grid-fake-row-selected-"+theme),o.__$placeholder$__)&&(jcc.dispatchCustomEvent(el,"e-unbind-node",{bubbles:!1,cancelable:!0,detail:{rowElement:t,node:s,iconElement:o.__$icon$__,textElement:o.__$text$__}}).defaultPrevented||(o.__$text$__.innerHTML=""),o.__$arrow$__.onclick=void 0,o[cname].removeChild(o.__$placeholder$__));e.preventDefault()}function insertNode(e,t){if(e=el.tree.addNode(e,t,!1),t.children)for(var n=0;n<t.children.length;n++)insertNode(e,t.children[n])}function nodeLargestIndex(e){var t=e.__$nodeIndex$__;return e.isExpanded()&&e.childNodes.length>0&&(t=nodeLargestIndex(e.childNodes[e.childNodes.length-1])),t}function updateNodeIndices(e,t){for(var n=t,o=0;n<e.length;n++,o++)e[n][cname].value.__$nodeIndex$__=t+o}function expandParents(e){null!=e&&(expandParents(e.parentNode),el.tree.expanded(e,!0,!1,!1))}function addNodeChildren(e,t,n,o){for(var s=0;s<t.childNodes.length;s++){var i={};i[cname]={value:t.childNodes[s]},n[0]++;var l=o+n[0];t.childNodes[s].__$nodeIndex$__=l,e.splice(l,0,i),t.childNodes[s].isExpanded()&&addNodeChildren(e,t.childNodes[s],n,o)}}function removeNodeChildren(e,t){for(var n=0;n<e.childNodes.length;n++)t[0]++,e.childNodes[n].__$selected$__&&(collapseSelectionChanged=!0,selectedNodes.remove(e.childNodes[n]),e.childNodes[n].__$selected$__=!1,lastSelectedNode==e.childNodes[n]&&(lastSelectedNode=null)),e.childNodes[n].__$nodeIndex$__=-1,e.childNodes[n].isExpanded()&&removeNodeChildren(e.childNodes[n],t)}function visitNodes(e,t){if(1!=t(e))for(var n=0;n<e.childNodes.length;n++)visitNodes(e.childNodes[n],t)}this.reservedColumnIDs.__$placeholder$__=!0,this.refresh=function(){el.dataset.items="[]",el.dataset.biColor="no","none"!=el.dataset.sort&&"asc"!=el.dataset.sort&&"desc"!=el.dataset.sort&&(el.dataset.sort="none"),indent=isNaN(el.dataset.itemIndent)?NODE_LEVEL_INDENT:parseInt(el.dataset.itemIndent),el.dataset.nodes&&0!=el.dataset.nodes.length||(el.dataset.nodes="[]"),this.destroy(),theme=this.theme(),nodeCounter=0,lastSelectedNode=null,selectedNodes=[],jcc.sortedArray(selectedNodes,"__$enum$__",!1);var refElement=el.querySelector("div:first-child"),nodesOrig;header=document.createElement("div"),header.dataset.role="grid-header",header.dataset.visible="no",refElement?jcc.insertBefore(header,refElement):el.appendChild(header),cname="##treecol##",column=document.createElement("div"),column.dataset.role="grid-column",column.dataset.align="left",column.dataset.sortable="no",column.dataset.resizable="no",column.dataset.width="100%",column.id=cname,header.appendChild(column),this.super_refresh(),el.tree=this;try{if(eval("nodesOrig="+el.dataset.nodes),null==nodesOrig||null==nodesOrig.length||isNaN(nodesOrig.length))throw"Incorrect nodes source provided!"}catch(e){return void alert("JCC: The nodes JavaScript you have specified for the tree seems to have errors. Please revise the data-nodes attribute data!")}roots=[],jcc.sortedArray(roots,"sortValue",!1,"desc"==el.dataset.sort),theme=this.theme(),el.classList.add("jcc-tree"),el.classList.add("jcc-tree-"+theme),el.addEventListener("e-click-row",onRowClick,!1),el.addEventListener("e-click-tree-row",onEClickTreeRow,!1),el.addEventListener("e-bind-row",onBindRow,!1),el.addEventListener("e-unbind-row",onUnbindRow,!1),el.addEventListener("e-selection",onESelection,!1),el.addEventListener("e-bind-node",onEBindNode,!1),el.addEventListener("e-unbind-node",onEUnbindNode,!1),setTimeout(function(){viewContents=el.querySelector(".jcc-contents"),el.addEventListener("e-resized",onViewResize,!1),jcc.resizeMonitor.addElement(el);for(var e=0;e<nodesOrig.length;e++)insertNode(null,nodesOrig[e]);el.grid.refreshItems(),adjustFakeRows()},0)},this.destroy=function(){jcc.resizeMonitor.removeElement(el),el.removeEventListener("e-resized",onViewResize),el.removeEventListener("e-click-row",onRowClick),el.removeEventListener("e-click-tree-row",onEClickTreeRow),el.removeEventListener("e-bind-row",onBindRow),el.removeEventListener("e-unbind-row",onUnbindRow),el.removeEventListener("e-selection",onESelection),el.removeEventListener("e-bind-node",onEBindNode),el.removeEventListener("e-unbind-node",onEUnbindNode),el.tree&&unprepareFakeRows(),this.super_destroy(),el.tree&&(roots=void 0,selectedNodes=void 0,header&&(column&&(column.gridColumn&&column.gridColumn.destroy(),header.removeChild(column),column=void 0),header.gridHeader&&header.gridHeader.destroy(),el.removeChild(header),header=void 0),el.classList.remove("jcc-tree"),el.classList.remove("jcc-tree-"+theme),delete el.tree)},this.addNode=function(e,t,n){null==n&&(n=!0);var o=new treeNode;o.__$enum$__=nodeCounter++,o.icon=t.icon,o.sortValue=null==t.sortValue?o.__$enum$__:t.sortValue,o.value=t.value,o.extra=t.extra,o.parentNode=e,jcc.sortedArray(o.childNodes,"sortValue",!1,"desc"==el.dataset.sort);var s=-1;if(e){o.__$level$__=e.__$level$__+1;var i=e.childNodes.add(o);e.isExpanded()&&(s=i>0?nodeLargestIndex(e.childNodes[i-1])+1:e.__$nodeIndex$__+1)}else{s=0==(i=roots.add(o))?0:nodeLargestIndex(roots[i-1])+1}if(s>=0){this.unbindRows();var l={};l[cname]={value:o};var d=this.items();d.splice(s,0,l),updateNodeIndices(d,s)}return n&&(this.refreshItems(),adjustFakeRows(),jcc.dispatchCustomEvent(viewContents,"scroll",{bubbles:!0,cancelable:!0})),o},this.removeNode=function(e,t){null==t&&(t=!0);var n=[];this.visitNodes(e,function(e){n.push(e)}),this.expanded(e,!1,!0,!1);var o=e.parentNode;if(o?(o.childNodes.remove(e),0==o.childNodes.length&&(o.__$expanded$__=!1)):roots.remove(e),this.unbindRows(),e.__$nodeIndex$__>=0){var s=this.items();s.splice(e.__$nodeIndex$__,1),updateNodeIndices(s,e.__$nodeIndex$__)}t&&(this.refreshItems(),adjustFakeRows()),e.__$selected$__&&(lastSelectedNode==e&&(lastSelectedNode=null),selectedNodes.remove(e),jcc.dispatchCustomEvent(viewContents,"scroll",{bubbles:!0,cancelable:!0}),jcc.dispatchCustomEvent(el,"e-selection",{bubbles:!1,cancelable:!1,detail:{selection:selectedNodes}}))},this.removeAll=function(){for(var e=0;e<roots.length;e++)this.removeNode(roots[e],e==roots.length-1)},this.__expanded=function(e,t,n,o){if(e.isExpanded()!=t&&0!=e.childNodes.length){var s=this.items();if(this.unbindRows(),t){expandParents(e.parentNode),e.__$expanded$__=!0;var i=[0];addNodeChildren(s,e,i,e.__$nodeIndex$__);for(var l=e.__$nodeIndex$__+i[0]+1;l<s.length;l++)s[l][cname].value.__$nodeIndex$__+=i[0]}else{var d=[0];e.__$expanded$__=!1,removeNodeChildren(e,d),s.splice(e.__$nodeIndex$__+1,d[0]);for(l=e.__$nodeIndex$__+1;l<s.length;l++)s[l][cname].value.__$nodeIndex$__-=d[0]}if(n)for(l=0;l<e.childNodes.length;l++)this.__expanded(e.childNodes[l],t,n,!1)}},this.expanded=function(e,t,n,o){if(1==arguments.length)return e.isExpanded();null==o&&(o=!0),collapseSelectionChanged=!1,this.__expanded(e,t,n,o),collapseSelectionChanged&&this.selection([e],!0),o&&(this.refreshItems(),adjustFakeRows(),jcc.dispatchCustomEvent(viewContents,"scroll",{bubbles:!0,cancelable:!0}))},this.expandedAll=function(e){for(var t=0;t<roots.length;t++)this.expanded(roots[t],e,!0,t==roots.length-1)},this.nodeChangedSortValue=function(e,t){null==t&&(t=!0);var n=e.parentNode;if(n){var o=n.isExpanded();this.expanded(n,!1,!1,!1);for(var s=0;s<n.childNodes.length;s++)if(n.childNodes[s]==e){n.childNodes.splice(s,1);break}n.childNodes.add(e),o&&this.expanded(n,!0,!1,t)}else{var i={};for(s=0;s<roots.length;s++)i[roots[s].sortValue]=roots[s].isExpanded(),this.expanded(roots[s],!1,!1,!1);var l=this.items();l.splice(e.__$nodeIndex$__,1),roots.splice(e.__$nodeIndex$__,1);var d=roots.add(e);e.__$nodeIndex$__=d;var r={};r[cname]={value:e},l.splice(d,0,r);for(s=0;s<roots.length;s++)roots[s].__$nodeIndex$__=s;for(s=0;s<roots.length;s++)this.expanded(roots[s],i[roots[s].sortValue],!1,t&&s==roots.length-1)}},this.refreshNode=function(e,t){var n=this;function o(e){e.__$nodeIndex$__>=0&&n.refreshItem(e.__$nodeIndex$__)}t?this.visitNodes(e,o):o(e)},this.visitNodes=function(e,t){null==t&&(t=function(t){jcc.dispatchCustomEvent(el,"e-visit-node",{bubbles:!1,cancelable:!0,detail:{node:e}})}),visitNodes(e,t)},this.findNodes=function(e,t){for(var n=[],o=0;o<roots.length;o++)this.visitNodes(roots[o],function(o){if(1==e(o))return n.push(o),t});return n},this.roots=function(){return roots},this.scrollTo=function(e){e.parentNode&&this.expanded(e.parentNode,!0,!1),e.__$nodeIndex$__>=0&&this.super_scrollTo(e.__$nodeIndex$__)},this.nodesSelectable=function(e,t){if(null==t){for(var n=[],o=0;o<e.length;o++)n.push(!e[o].__$unselectable$__);return n}var s=[];for(o=0;o<e.length;o++)e[o].__$unselectable$__=!t,!t&&e[o].__$selected$__&&s.push(e[o]);s.length>0&&this.selection(s,!1,!0)},this.selection=function(e,t,n){if(0==arguments.length)return selectedNodes.slice();if("none"!=el.dataset.selection){if("single"==el.dataset.selection&&e.length>1&&e.splice(1,e.length-1),!t||"single"==el.dataset.selection){for(var o=0;o<selectedNodes.length;o++)selectedNodes[o].__$selected$__=!1,this.refreshNode(selectedNodes[o],!1);selectedNodes.length=0}var s=null;for(o=0;o<e.length;o++){var i=e[o];i.__$unselectable$__||n||i.__$selected$__?(i.__$selected$__&&selectedNodes.remove(i),i.__$selected$__=!1):(i.parentNode&&i.__$nodeIndex$__<0&&this.expanded(i.parentNode,!0,!1,!0),i.__$selected$__=!0,s=i,selectedNodes.add(i)),this.refreshNode(i)}if(lastSelectedNode&&!lastSelectedNode.__$selected$__&&(lastSelectedNode=null),0==selectedNodes.length)lastSelectedNode=null;else{var l=this.rangeSelect();(l&&!lastSelectedNode||!l)&&(lastSelectedNode=s)}jcc.dispatchCustomEvent(el,"e-selection",{bubbles:!1,cancelable:!1,detail:{selection:selectedNodes.slice()}})}},this.selectAll=function(){for(var e=[],t=0;t<roots.length;t++)this.visitNodes(roots[t],function(t){e.push(t)});this.expandedAll(!0),this.selection(e)},this.unselectAll=function(){this.selection([])}},jcc.widgets["tree-header"]={version:"1.0",can_enhance:function(e){return"DIV"==e.nodeName&&"tree-header"==e.getAttribute("data-role")},enhance:function(e){e.treeHeader?e.treeHeader.refresh():new jcc.treeHeader(e).refresh()},unenhance:function(e){e.treeHeader&&e.treeHeader.destroy()}},jcc.treeHeader=function(e){var t;this.toolbar=jcc.toolbar,this.toolbar(e),this.super_refresh=this.refresh,this.super_destroy=this.destroy,this.refresh=function(){e.parentNode.tree?(this.destroy(),this.super_refresh(),e.dataset.orientation="horizontal",e.dataset.position="top","yes"!=e.dataset.visible&&"no"!=e.dataset.visible&&(e.dataset.visible="yes"),e.treeHeader=this,t=this.theme(),e.classList.add("jcc-tree-header"),e.classList.add("jcc-tree-header-"+t)):alert("JCC: The 'tree-header' must be a direct child of a 'tree'. Please revise your HTML code!")},this.destroy=function(){e.treeHeader&&(e.classList.remove("jcc-tree-header"),e.classList.remove("jcc-tree-header-"+t),delete e.treeHeader)}},jcc.widgets["tree-footer"]={version:"1.0",can_enhance:function(e){return"DIV"==e.nodeName&&"tree-footer"==e.getAttribute("data-role")},enhance:function(e){e.treeFooter?e.treeFooter.refresh():new jcc.treeFooter(e).refresh()},unenhance:function(e){e.treeFooter&&e.treeFooter.destroy()}},jcc.treeFooter=function(e){var t;this.toolbar=jcc.toolbar,this.toolbar(e),this.super_refresh=this.refresh,this.super_destroy=this.destroy,this.refresh=function(){e.parentNode.tree?(e.dataset.orientation="horizontal",e.dataset.position="bottom","yes"!=e.dataset.visible&&"no"!=e.dataset.visible&&(e.dataset.visible="yes"),this.destroy(),this.super_refresh(),e.treeFooter=this,t=this.theme(),e.classList.add("jcc-tree-footer"),e.classList.add("jcc-tree-footer-"+t)):alert("JCC: The 'tree-footer' must be a direct child of a 'tree'. Please revise your HTML code!")},this.destroy=function(){this.super_destroy(),e.treeFooter&&(e.classList.remove("jcc-tree-footer"),e.classList.remove("jcc-tree-footer-"+t),delete e.treeFooter)}};